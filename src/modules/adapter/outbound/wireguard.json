{
  "type": "object",
  "title": "outbound-wireguard",
  "definitions": {
    "compatible": { "$ref": "../../../definitions/compatible.json" },
    "types": { "$ref": "../../../definitions/types.json" },
    "patterns": { "$ref": "../../../definitions/patterns.json" },
    "enums": { "$ref": "../../../definitions/enums.json" },
    "basic-option": { "$ref": "./base.json#/definitions/basic-option" },
    "smux": { "$ref": "./singmux.json" },
    "amnezia-wg-option": {
      "type": "object",
      "title": "AmneziaWG配置",
      "properties": {
        "jc": {
          "$ref": "#/definitions/compatible/integer",
          "title": "垃圾包数量",
          "description": "在握手前发送的随机垃圾包数量，用于增加流量混淆",
          "markdownDescription": "在握手前发送的随机垃圾包数量，用于增加流量混淆"
        },
        "jmin": {
          "$ref": "#/definitions/compatible/integer",
          "title": "垃圾包的最小字节大小",
          "description": "单个垃圾包的最小长度，最大值建议不超过 1280 字节",
          "markdownDescription": "单个垃圾包的最小长度，最大值建议不超过 1280 字节"
        },
        "jmax": {
          "$ref": "#/definitions/compatible/integer",
          "title": "垃圾包的最大字节大小",
          "description": "单个垃圾包的最大长度，最大值建议不超过 1280 字节",
          "markdownDescription": "单个垃圾包的最大长度，最大值建议不超过 1280 字节"
        },
        "s1": {
          "$ref": "#/definitions/compatible/integer",
          "title": "初始化握手包填充字节数",
          "description": "设置初始化握手数据包中插入的随机填充数据长度（Junk Size）",
          "markdownDescription": "设置初始化握手数据包中插入的随机填充数据长度（Junk Size）"
        },
        "s2": {
          "$ref": "#/definitions/compatible/integer",
          "title": "握手响应包填充字节数",
          "description": "设置握手响应数据包中插入的随机填充数据长度",
          "markdownDescription": "设置握手响应数据包中插入的随机填充数据长度"
        },
        "s3": {
          "$ref": "#/definitions/compatible/integer",
          "title": "Cookie Reply 包填充字节数",
          "description": "设置 Cookie Reply 数据包中插入的随机填充数据长度",
          "markdownDescription": "设置 Cookie Reply 数据包中插入的随机填充数据长度"
        },
        "s4": {
          "$ref": "#/definitions/compatible/integer",
          "title": "普通传输包填充字节数",
          "description": "设置普通传输数据包中插入的随机填充数据长度",
          "markdownDescription": "设置普通传输数据包中插入的随机填充数据长度"
        },
        "h1": {
          "$ref": "#/definitions/compatible/string",
          "title": "初始化握手包 Magic Header",
          "description": "指定初始化握手包的 Magic Header 内容，作为包体前缀插入，用于混淆协议特征",
          "markdownDescription": "指定初始化握手包的 Magic Header 内容，作为包体前缀插入，用于混淆协议特征"
        },
        "h2": {
          "$ref": "#/definitions/compatible/string",
          "title": "握手响应包 Magic Header",
          "description": "指定握手响应包的 Magic Header 内容，作为包体前缀插入，用于混淆协议特征",
          "markdownDescription": "指定握手响应包的 Magic Header 内容，作为包体前缀插入，用于混淆协议特征"
        },
        "h3": {
          "$ref": "#/definitions/compatible/string",
          "title": "Underload 包 Magic Header",
          "description": "指定 Underload 包的 Magic Header 内容，用于协议混淆",
          "markdownDescription": "指定 Underload 包的 Magic Header 内容，用于协议混淆"
        },
        "h4": {
          "$ref": "#/definitions/compatible/string",
          "title": "普通传输包 Magic Header",
          "description": "指定普通传输包的 Magic Header 内容，作为包体前缀插入，进一步防止流量被特征识别",
          "markdownDescription": "指定普通传输包的 Magic Header 内容，作为包体前缀插入，进一步防止流量被特征识别"
        },
        "i1": {
          "$ref": "#/definitions/compatible/string",
          "title": "特殊 Junk 字段1",
          "description": "用于在数据包中插入自定义的特殊 Junk 数据段，用于协议混淆与增强抗检测能力",
          "markdownDescription": "用于在数据包中插入自定义的特殊 Junk 数据段，用于协议混淆与增强抗检测能力"
        },
        "i2": {
          "$ref": "#/definitions/compatible/string",
          "title": "特殊 Junk 字段2",
          "description": "同上，用于插入第二段特殊 Junk 数据",
          "markdownDescription": "同上，用于插入第二段特殊 Junk 数据"
        },
        "i3": {
          "$ref": "#/definitions/compatible/string",
          "title": "特殊 Junk 字段3",
          "description": "同上，用于插入第三段特殊 Junk 数据",
          "markdownDescription": "同上，用于插入第三段特殊 Junk 数据"
        },
        "i4": {
          "$ref": "#/definitions/compatible/string",
          "title": "特殊 Junk 字段4",
          "description": "同上，用于插入第四段特殊 Junk 数据",
          "markdownDescription": "同上，用于插入第四段特殊 Junk 数据"
        },
        "i5": {
          "$ref": "#/definitions/compatible/string",
          "title": "特殊 Junk 字段5",
          "description": "同上，用于插入第五段特殊 Junk 数据",
          "markdownDescription": "同上，用于插入第五段特殊 Junk 数据"
        },
        "j1": {
          "$ref": "#/definitions/compatible/string",
          "title": "受控 Junk 字段1",
          "description": "受控 Junk 字段，按需插入特定 Junk 数据，增强协议多样性（AmneziaWG v1.5特有，v2已被移除）",
          "markdownDescription": "受控 Junk 字段，按需插入特定 Junk 数据，增强协议多样性（AmneziaWG v1.5特有，v2已被移除）"
        },
        "j2": {
          "$ref": "#/definitions/compatible/string",
          "title": "受控 Junk 字段2",
          "description": "同上，第二段受控 Junk 字段",
          "markdownDescription": "同上，第二段受控 Junk 字段"
        },
        "j3": {
          "$ref": "#/definitions/compatible/string",
          "title": "受控 Junk 字段3",
          "description": "同上，第三段受控 Junk 字段",
          "markdownDescription": "同上，第三段受控 Junk 字段"
        },
        "itime": {
          "$ref": "#/definitions/compatible/integer",
          "title": "特殊握手超时时间（AmneziaWG v1.5特有，v2已被移除）",
          "description": "单位：秒",
          "markdownDescription": "单位：秒"
        }
      }
    },
    "wireguard-peer-option": {
      "type": "object",
      "title": "peer配置",
      "required": ["server", "port"],
      "properties": {
        "server": {
          "$ref": "#/definitions/patterns/server",
          "title": "代理节点服务器",
          "description": "域名或IP",
          "markdownDescription": "域名或IP"
        },
        "port": {
          "$ref": "#/definitions/patterns/port",
          "title": "代理节点端口号",
          "description": "代理节点端口号",
          "markdownDescription": "代理节点端口号"
        },
        "public-key": {
          "$ref": "#/definitions/compatible/string",
          "title": "公钥",
          "description": "公钥",
          "markdownDescription": "公钥"
        },
        "pre-shared-key": {
          "$ref": "#/definitions/compatible/string",
          "title": "预共享密钥",
          "description": "预共享密钥",
          "markdownDescription": "预共享密钥"
        },
        "reserved": {
          "type": "array",
          "title": "保留字段值",
          "description": "部分WARP节点需要使用",
          "markdownDescription": "部分`WARP`节点需要使用"
        },
        "allowed-ips": {
          "$ref": "#/definitions/types/ipCIDRArray",
          "title": "允许进行流量转发的IP段",
          "description": "允许进行流量转发的IP段",
          "markdownDescription": "允许进行流量转发的IP段"
        }
      }
    }
  },
  "allOf": [
    { "title": "basic配置", "$ref": "#/definitions/basic-option" },
    {
      "type": "object",
      "title": "wireguard配置",
      "required": ["name", "private-key"],
      "properties": {
        "type": {
          "$ref": "#/definitions/compatible/string",
          "title": "代理节点类型",
          "description": "代理节点类型",
          "markdownDescription": "代理节点类型"
        },
        "name": {
          "$ref": "#/definitions/compatible/string",
          "title": "代理节点名称",
          "description": "代理节点名称",
          "markdownDescription": "代理节点名称"
        },
        "ip": {
          "$ref": "#/definitions/patterns/ipv4",
          "title": "本机在Wireguard网络中使用的IPv4地址",
          "description": "本机在Wireguard网络中使用的IPv4地址",
          "markdownDescription": "本机在`Wireguard`网络中使用的`IPv4`地址"
        },
        "ipv6": {
          "$ref": "#/definitions/patterns/ipv6",
          "title": "本机在Wireguard网络中使用的IPv6地址",
          "description": "本机在Wireguard网络中使用的IPv6地址",
          "markdownDescription": "本机在`Wireguard`网络中使用的`IPv6`地址"
        },
        "private-key": {
          "$ref": "#/definitions/compatible/string",
          "title": "私钥",
          "description": "私钥(Base64编码)",
          "markdownDescription": "私钥(`Base64`编码)"
        },
        "workers": {
          "$ref": "#/definitions/compatible/integer",
          "title": "工作线程",
          "description": "工作线程(默认为CPU逻辑核心数)",
          "markdownDescription": "工作线程(默认为CPU逻辑核心数)"
        },
        "mtu": {
          "$ref": "#/definitions/compatible/integer",
          "title": "最大传输单元",
          "description": "最大传输单元",
          "markdownDescription": "最大传输单元",
          "default": 1408
        },
        "udp": {
          "$ref": "#/definitions/compatible/boolean",
          "title": "启用UDP",
          "description": "启用UDP",
          "markdownDescription": "启用`UDP`",
          "default": true
        },
        "persistent-keepalive": {
          "$ref": "#/definitions/compatible/integer",
          "title": "持久保活间隔",
          "description": "单位:s",
          "markdownDescription": "单位:s"
        },
        "amnezia-wg-option": { "$ref": "#/definitions/amnezia-wg-option" },
        "peers": {
          "type": "array",
          "title": "peer配置",
          "description": "peer配置",
          "markdownDescription": "peer配置",
          "items": { "$ref": "#/definitions/wireguard-peer-option" }
        },
        "remote-dns-resolve": {
          "$ref": "#/definitions/compatible/boolean",
          "title": "强制DNS远程解析",
          "description": "强制DNS远程解析",
          "markdownDescription": "强制DNS远程解析",
          "default": false
        },
        "dns": {
          "$ref": "#/definitions/types/serverArray",
          "title": "DNS解析服务器",
          "description": "DNS解析服务器(要求启用remote-dns-resolve)",
          "markdownDescription": "DNS解析服务器(要求启用`remote-dns-resolve`)"
        },
        "refresh-server-ip-interval": {
          "$ref": "#/definitions/compatible/integer",
          "title": "服务器IP刷新间隔",
          "description": "单位:s",
          "markdownDescription": "单位:s"
        }
      },
      "if": { "not": { "properties": { "peers": { "type": "array" } } } },
      "then": { "$ref": "#/definitions/wireguard-peer-option" }
    },
    {
      "type": "object",
      "title": "smux配置",
      "properties": {
        "smux": { "title": "smux配置", "$ref": "#/definitions/smux" }
      }
    }
  ]
}
